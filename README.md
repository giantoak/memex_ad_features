# memex_ad_features
The purpose of this repository is to calculate a number of economic metrics on MEMEX `escorts` data. It's a small data pipeline intended to take a number of extractions from scraped advertisements and spit out usable JSON data.

## Design
The different data targets are managed by the [`Makefile`.](https://github.com/giantoak/memex_ad_features/blob/master/Makefile) Input data for a given target is passed through a number of Python and R scripts, and a generated CSV is spat out.

### Input
**Currently**, the Makefile takes as input TSV-file dumps of Lattice data stored in S3 buckets, and the tsv files dumped by the different files. **Eventually** the makefile will replace these S3 dumps Lattice files stored in HDFS. Potentially, it will also take other extractions from the different teams as well.

### Output
**Currently**, the Makefile spits out a number of different CSV files. **Eventually** it will dump these files into HDFS for general consumption.

### Target Dependencies
The below dependency graph is intended to provide an overview of the makefile and chain of targets that it can create. If it doesn't render correctly, know that all is well! Just click on the "missing" icon to get to the file itself.

![Markdown Target Dependencies](https://github.com/giantoak/memex_ad_features/blob/master/makefile_graph.svg "Makefile sources and targets")

## Target Plans
We will be pairing down this version of the makefile to focus on a limited number of targets. Specifically:

* Ad-level metrics

* Phone-level metrics

* City/MSA-level metrics
  * Those laid out in `msa_characteristics.csv` (generated by [`make_msa_characteristics.py`](https://github.com/giantoak/memex_ad_features/blob/2593f8a89ff70b57bba8dd4c4260c7b3df648e63/make_msa_characteristics.py))
    * [ ] Ad count
    * Price data per MSA
      * [ ] Mean
      * [ ] The xth price percentile, where x in range(0, 100, 5) (redundant with median)
  * Incall rate per MSA
    * [ ] Mean
    * [ ] The xth price percentile, where x in range(0, 100, 5) (redundant with median)
  * Outcall rate per MSA
    * [ ] Mean
    * [ ] The xth price percentile, where x in range(0, 100, 5) (redundant with median)
  
* Ad-level matrics
  * Those laid out in `ad_price_ad_level.csv` (generated by [`make_ad_prices.py`](https://github.com/giantoak/memex_ad_features/blob/master/make_ad_prices.py))
    * [ ] Average price price per hour (`price_per_hour` variable in data)
    * [ ] Is ad priced per hour? (`1hr` variable in data)
    * [ ] All others… (This needs breaking down, if it exists) 
  * [ ] Total number of extracted prices (possibly not included in data at this point, but good to have)
  
* Phone-level metrics

*No* metrics at this level are in the original makefile, but we have been moving in that direction. (See, for instance, [`make_phone_characteristics.py`](https://github.com/giantoak/memex_ad_features/blob/master/make_phone_characteristics.py) and [`make_phone_level.py`](https://github.com/giantoak/memex_ad_features/blob/master/make_phone_level.py).) In the future, we might just start generating all of these metrics ourselves.

  * [ ] All values in `data/bach/phones.csv`. (Not in repo)
    * [ ] `n_ads` - Number of ads posted by this phone number in sample
    * [ ] `n_distinct_locations` - Number of unique cities
    * [ ] `location_tree_length` - a measure of how far apart the phone number appears around the US
    * [ ] `n_incall` - Number of ads posted by this phone number that are incalls.
    * [ ] `n_outcall` - Number of ads posted by this phone number that are outcalls.
    * [ ] Other metrics… (needs to be broken down)
  * [ ] All values in `data/bach/phones_by_month.csv`. (Not in repo)
    * [ ] `n_ads` - Number of ads posted by this phone number in sample
    * [ ] `n_distinct_locations` - Number of unique cities
    * [ ] `location_tree_length` - a measure of how far apart the phone number appears around the US
    * [ ] `n_incall` - Number of ads posted by this phone number that are incalls.
    * [ ] `n_outcall` - Number of ads posted by this phone number that are outcalls.
    * [ ] Other metrics… (needs to be broken down)

## Future Possibilities

* MSA-level values, cross-tabbed by gender using ACS data